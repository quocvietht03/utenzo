<?php

/**
 * Block Name: Widget - Video Popup
 **/
$background = get_field('background_widget');
$heading = get_field('heading');
$link = get_field('link');

?>
<div id="<?php echo 'bt_block--' . $block['id']; ?>" class="widget widget-block bt-block-video-popup" <?php if (!empty($background)) { ?>style="background-image:url(<?php echo esc_url($background['url']) ?>)" <?php } ?>>
  <div class="bt-video-popup">
    <?php

    if (!empty($heading)) {
      echo '<h3 class="bt-video-popup--head">' . esc_html($heading) . '</h3>';
    }
    if (strpos($link['url'], 'youtube.com/watch') !== false) {
      parse_str(parse_url($link['url'], PHP_URL_QUERY), $query_vars);
      if (isset($query_vars['v'])) {
        $embed_url = 'https://www.youtube.com/embed/' . $query_vars['v'];
        unset($query_vars['v']);
        if (!empty($query_vars)) {
          $embed_url .= '?' . http_build_query($query_vars);
        }

        $link['url'] = $embed_url;
      }
    } elseif (strpos($link['url'], '.mp4') !== false) {
      $embed_url = $link['url'];
      $link['url'] = $embed_url;
    }

    $lightbox_settings = json_encode(array(
      'type' => 'video',
      'videoType' => (strpos($link['url'], 'youtube.com/embed') !== false) ? 'youtube' : 'hosted',
      'url' => esc_url($link['url']),
    ));
    $lightbox_settings_encoded = base64_encode($lightbox_settings);
    if (!empty($link)) {
      echo '<a class="bt-video-popup--link bt-button-effect" href="#elementor-action:action=lightbox&settings=' . $lightbox_settings_encoded . '" ><svg xmlns="http://www.w3.org/2000/svg" width="66" height="67" viewBox="0 0 66 67" fill="none">
  <path d="M64.7493 24.1941C62.8901 17.4155 58.5456 11.3017 52.7441 7.46467C46.5966 3.39934 38.5597 2.17784 31.3701 2.01421C21.3304 1.78082 8.61291 5.69521 3.67362 15.414C3.26254 16.2219 4.4733 16.9158 4.88439 16.1078C8.38425 9.22019 16.7434 5.24237 23.9556 3.93842C31.7137 2.53807 40.1966 3.63907 47.5374 6.41821C55.2019 9.31912 60.5235 15.9784 63.1387 23.6829C66.0501 32.255 64.4382 40.7915 59.7913 48.321C50.1976 63.8618 26.652 68.9064 12.3327 57.1277C5.77279 51.7318 1.49449 44.5131 1.41202 35.8789C1.36329 30.7899 2.3404 25.1073 4.84316 20.6424C5.6191 19.2598 6.66118 18.0751 7.83697 17.0058C7.85446 16.7281 7.87445 16.4528 7.89319 16.1788C7.757 16.0025 7.6408 15.8122 7.58082 15.5763C7.57457 15.5497 7.57582 15.5294 7.56957 15.5015C6.85486 16.1116 6.16263 16.7522 5.50789 17.4409C2.64528 20.4484 1.51698 24.6203 0.719797 28.6044C-0.864573 36.5194 0.0763029 43.9195 4.54703 50.6067C8.37425 56.3324 14.2769 61.6611 20.9543 63.5219C28.9761 65.7569 37.3515 65.5679 44.9422 62.1165C48.3771 60.5563 52.1006 59.024 54.987 56.5049C58.5268 53.4125 61.1858 49.0452 63.3324 44.8911C66.6049 38.5591 66.6023 30.9459 64.7493 24.1941Z" fill="white"/>
  <path d="M22.1612 40.3995C22.2899 41.8582 22.3123 44.3063 23.8167 44.9633C23.8805 45.047 23.9479 45.1244 24.0254 45.184C25.5223 46.3282 27.609 44.5447 28.8685 43.7773C32.3633 41.654 44.5947 33.5829 46.4103 30.7416C46.5989 30.4448 46.5327 30.1645 46.3528 29.9692C46.3403 29.7662 46.2516 29.5658 46.0304 29.4263C44.0037 28.168 34.9473 23.9758 32.4233 23.027C31.1188 22.5336 25.4348 20.0589 24.6614 20.0398C21.6963 18.1055 22.1362 27.0479 22.1212 27.8433C22.04 32.0088 21.7963 36.2441 22.1612 40.3995ZM26.1895 31.7526C26.0796 31.802 25.9871 31.882 25.9184 31.9834C25.9134 31.6042 25.9072 31.2274 25.9047 30.8533C26.0246 30.923 26.1508 30.9852 26.277 31.0486C26.2508 31.2795 26.2195 31.5154 26.1895 31.7526ZM26.4482 37.666C26.5269 37.3514 26.6369 37.0343 26.7693 36.7172C28.7473 36.2466 30.6278 35.2636 32.5595 34.6307C33.5016 34.3681 34.445 34.1055 35.3821 33.8277C32.4633 35.2167 29.482 36.4547 26.4482 37.666ZM30.7215 32.6773C30.4966 32.7813 30.2692 32.8828 30.048 32.9944C29.8506 32.8701 29.6494 32.7737 29.4445 32.6849C29.8693 32.6722 30.2954 32.6671 30.7215 32.6773ZM30.123 30.8038C30.1517 30.786 30.183 30.7721 30.2154 30.7569C31.0176 30.9306 31.8198 31.0499 32.6445 31.0613C33.218 31.131 33.7915 31.2046 34.3663 31.2718C34.3113 31.2921 34.2563 31.3086 34.2001 31.3289C32.9881 31.2008 31.5249 31.0613 30.123 30.8038ZM36.0781 29.3083C35.1272 28.9658 34.1751 28.6119 33.2155 28.2251C31.6349 27.5883 30.0605 27.1355 28.4099 26.741C27.8939 26.6192 27.469 26.4112 27.0954 26.1512C30.2067 26.6471 33.2005 27.8686 36.0781 29.3083ZM28.6086 28.2327C27.6715 28.1413 26.7231 28.0969 25.7622 28.0995C25.7297 27.7228 25.6922 27.3486 25.656 26.9718C26.5906 27.6327 27.564 27.965 28.6086 28.2327Z" fill="white"/>
</svg></a>';
    }
    ?>

  </div>
</div>